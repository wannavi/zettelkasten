---
title: AWS ECS로 시작하는 컨테이너 오케스트레이션
date: 2022-11-07
---

## 주제 : #ECS #Container

## ✏️ 메모

### ECS 에 대해서

- ECS 는 엘라스틱 컨테이너 서비스는 아마존 웹서비스에서 제공하는 매니지드 컨테이너 오케스트레이션 서비스이다.

### 클러스터와 컨테이너 인스턴스

![[public/Pasted image 20221108184830.png]]

- ECS의 가장 기본적인 단위 = "클러스터"

클러스터는 도커 컨테이너를 실행할 수 있는 가상의 공간으로 이해할 수 있습니다. 클러스터는 프로젝트나 컨테이너의 성격에 따라서 나눠질 수 있습니다. ECS 클러스터는 기본적으로 EC2와 같은 컴퓨팅 자원을 기본적으로 포함하고 있지 않은 논리적인 단위입니다. 따라서 컴퓨팅 자원이 없는 빈 클러스터를 만드는 것도 가능합니다?! 그리고 EC2에 ecs-client 라는 서비스를 실행해서 특정 클러스터에 연결할 수 있습니다. 이렇게 클러스터에 연결된 EC2 인스턴스를 "컨테이너 인스턴스"라고 부릅니다. ecs-client는 컨테이너 인스턴스의 자원을 모니터링 및 관리하고, 클러스터로 요청된 컨테이너들을 적절하게 실행하는 역할을 합니다.

### 태스크 디피니션(task definition)과 태스크(task)

![[public/Pasted image 20221108234347.png]]

- ECS에서 컨테이너를 실행하는 최소 단위는 "태스크"입니다.

태스크는 컨테이너와는 조금 차이가 있습니다. 태스크는 하나 이상의 컨테이너로 구성됩니다. 일반적으로 하나의 필수 컨테이너만으로 구성됩니다. 일반적으로는 하나의 필수 컨테이너만으로 구성됩니다. 하지만 필요에 따라 하나의 필수 컨테이너와 n개의 추가적인 컨테이너 조합이 될 수도 있습니다.

태스크를 실행하려면 태스크 디피니션이 필요합니다. 태스크를 실행할 때 "컨테이너 네트워크 모드", "태스크 역할", "도커 이미지", "실행 명령어", "CPU 제한", "메모리 제한" 등 다수의 설정이 필요합니다. 컨테이너 오케스트레이션에서는 컨테이너가 필요에 따라서 자동적으로 실행되거나 종료될 수 있습니다. 따라서 매번 이러한 설정들을 지정하기보다는, 미리 설정들의 집합을 하나의 단위로 정의해놓고 사용합니다. 이 단위가 바로 태스크 디피니션입니다. 한 번 태스크 디피니션을 만들면 이 태스크 디피니션을 기반으로 특정 설정을 변경할 수 있습니다. 이렇게 변경된 내용들은 모두 리비전으로 저장됩니다.

또한 태스크는 클러스터에 종속적이지만, 태스크 디피니션은 클러스터에 종속적이지 않다는 중요한 특징이 있습니다.

> 여기까지의 내용을 처음 들으면 정신이 매우 혼미해질 것 입니다.

### 서비스(service)

![[public/Pasted image 20221108235931.png]]

클러스터에는 두 가지 방식으로 태스크를 실행할 수 있습니다.

- 태스크 디피니션으로 "직접" 태스크를 실행하는 방식
  - 이 태스크는 곧바로 실행되며 실행이 된 이후에는 더 이상 관리되지 않습니다.
  - 일회성 명령어라면 한 번 실행된 후 종료되며, 데몬 프로세스라면 태스크를 명시적으로 종료할 때까지 컨테이너가 남아있습니다.
- "서비스"를 정의하는 방식
  - 서비스는 하나의 태스크 디피니션(리비전)과 연결됩니다.
  - 서비스는 크게 "리플리카 타입"과 "데몬 타입"이 있습니다.
    - 데몬 타입으로 실행하는 경우 모든 컨테이너 인스턴스에 해당하는 태스크가 하나씩 실행됩니다.

### ECR, 엘라스틱 컨테이너 레지스트리

- AWS ECS에서는 엘라스틱 컨테이너 레지스트리라는 프라이빗 도커 레지스트리 서비스를 제공하고 있습니다.
  - "도커 레지스트리"는 도커 이미지를 저장 및 관리하는 서비스입니다.
- 일반적으로 도커에서 공식적으로 제공하는 "도커 허브"가 많이 이용됩니다. 하지만 이미지를 비공개적으로 푸시하거나 풀하는 경우에는 도커 허브의 유료 플랜을 이용하거나 직접 도커 레지스트리 서비스를 운용해야합니다.
- ECR을 사용해서 프라이빗 도커 레지스트리를 대체할 수 있으며, IAM과 조합함으로서 세세한 권한 관리가 가능합니다.

### 중간 점검

- Docker : 컨테이너 가상화 도구
- Dockerfile : 도커의 이미지 생성 과정을 정의한 DSL 형식으로 작성된 파일
- 클러스터 : ECS의 가장 기본적인 단위. 서비스나 태스크가 실행되는 공간을 나누는 논리적인 공간.
- 컨테이너 인스턴스 : 클러스터에서 속한 인스턴스. 클러스터에 서비스나 태스크 실행을 요청하면 클러스터에 속한 컨테이너 인스턴스 중 하나에서 실행된다.
- 서비스 : 태스크를 관리하는 단위. 내부적으로 태스크 실행을 위한 스케줄러를 가지고 있으며 서비스에 정의한 대로 태스크(들)이 실행되는 상태를 유지시키려 한다.
- 엘라스틱 컨테이너 서비스 : AWS에서 제공하는 프라이빗 도커 레지스트리 (이미지 저장소)

## 🔗 참고문헌

- [44bits](https://www.44bits.io/ko/post/container-orchestration-101-with-docker-and-aws-elastic-container-service#ecs-%ED%8A%9C%ED%86%A0%EB%A6%AC%EC%96%BC)

## 🔗 연결문서

- [[posts/22-10-11 CD 작업을 진행해보자]]
- [[posts/22-11-08 Jenkins를 활용한 CI와 CD]]
