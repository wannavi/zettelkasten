---
title: 페이징 개선하기
date: 2022-11-29
---

## 주제 : #DB #페이징 #인덱스 #커버링-인덱스

## ✏️ 메모

### 페이징 방식 비교

- 페이지 번호(offset)과 페이지 사이즈(limit)을 기반으로 한 페이징
- 페이지 번호(offset)가 없는 더보기(More) 방식의 페이징 (페이스북과 같은 SNS의 게시글 조회)
  - 이 방식이 일반적으로 더 빠릅니다.

전자의 방식이 느린 이유을 간단하게 설명하자면, 만약 `offset`을 만건으로 설정하고 검색한다면 만건을 읽어야하기 때문입니다. 10000+건을 읽고 필요한 앞에 10000개의 행은 그냥 버리는 것입니다. 따라서 뒤로 갈수록 쓸데없이 읽어야 할 행의 개수가 많아져 점점 뒤로 갈수록 느려지는 것입니다.

```sql
SELECT * FROM posts
FROM [conditions]
ORDER BY id DESC
OFFSET [page_no] LIMIT [page_size];
```

반면 후자의 방식은 "조회 시작 부분을 인덱스로 빠르게 찾아 (커서의 개념)" 매번 첫 페이지만 읽도록 하는 방식입니다. (클러스터 인덱스인 PK를 조회 시작 부분 조건문으로 사용했기 때문에 빠르게 조회됩니다.)

```sql
SELECT * FROM posts
FROM [conditions] AND id < [last_id]
ORDER BY id DESC
LIMIT [page_size];
```

> 결론: 커서 방식을 도입하면 인덱스를 통해 OFFSET 조회 시작의 오버헤드를 없앨 수 있다. 따라서 페이지가 아무리 뒤로 가더라도 처음 페이지를 읽은 것과 같은 성능을 가지게 된다.

### 근데 No Offset 방식을 사용할 수 없는 경우라면

실제 개발을 진행하다보면 요구사항에 맞게 개발을 진행해야하는 경우가 대다수 입니다. 이때 `Offset` 기반으로 설계하기를 요청받는다면 우리는 어떤 식으로 페이지네이션을 개선시킬 수 있을까요?

첫 번째 방법으로는 `커버링 인덱스`를 이용하는 것입니다. "커버링 인덱스"는 쿼리를 충족하는데 필요한 모든 데이터를 갖는 인덱스를 의미합니다. 말 그대로 `SELECT / WHERE / GROUP BY / ORDER BY` 등에 활용되는 모든 컬럼이 인덱스의 구성 요소인 경우를 말합니다.

## 🔗 참고문헌

- [# 1. 페이징 성능 개선하기 - No Offset 사용하기](https://jojoldu.tistory.com/528?category=637935)

## 🔗 연결문서
